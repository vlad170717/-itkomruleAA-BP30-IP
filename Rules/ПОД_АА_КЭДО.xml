<ПравилаОбмена>
	<ВерсияФормата РежимСовместимости="РежимСовместимостиСБСП20">2.01</ВерсияФормата>
	<Ид>c1c26ea3-7970-4271-9172-b82b883d0449    </Ид>
	<Наименование>Автосалон5 --&gt; КлиентЭДОБазовая Италком</Наименование>
	<ДатаВремяСоздания>2022-11-10T23:29:53</ДатаВремяСоздания>
	<Источник ВерсияПлатформы="8.0" ВерсияКонфигурации="5.0.07.03" СинонимКонфигурации="Альфа-Авто: Автосалон+Автосервис+Автозапчасти ПРОФ. Редакция 5">Автосалон5</Источник>
	<Приемник ВерсияПлатформы="8.0" ВерсияКонфигурации="2.9.4.31" СинонимКонфигурации="Клиент ЭДО (базовая), редакция 2.9">КлиентЭДОБазовая</Приемник>
	<ПослеЗагрузкиПравилОбмена>
ВерсияПравил	= "//#%#063#%%#";
ВерсияПравил	= СтрЗаменить(ВерсияПравил, "//#%#","");
ВерсияПравил	= СтрЗаменить(ВерсияПравил, "#%%#","");
Сообщить("Версия правил " + ВерсияПравил);
//Параметры.КодГруппыТоваров     = "00-00000001";</ПослеЗагрузкиПравилОбмена>
	<Параметры>
		<Параметр Имя="КодГруппыТоваров                                  " Наименование="КодГруппыТоваров                                  " ИспользуетсяПриЗагрузке="true" УстанавливатьВДиалоге="true" ТипЗначения="Строка" ПередаватьПараметрПриВыгрузке="true"/>
	</Параметры>
	<Обработки/>
	<ПравилаКонвертацииОбъектов>
		<Группа>
			<Код>Справочники</Код>
			<Наименование>Справочники</Наименование>
			<Порядок>50</Порядок>
			<Правило>
				<Код>Номенклатура</Код>
				<Наименование>Справочник: Номенклатура</Наименование>
				<Порядок>50</Порядок>
				<ПередВыгрузкой>	Отказ = Источник.ЭтоГруппа;
</ПередВыгрузкой>
				<ПослеЗагрузки>Если Не Объект.ЭтоГруппа Тогда
	ГруппаТоваров = Справочники.Номенклатура.НайтиПоКоду(Параметры.КодГруппыТоваров);
	Если Не ГруппаТоваров.Пустая() И ГруппаТоваров.ЭтоГруппа Тогда
		Объект.Родитель = ГруппаТоваров;
	КонецЕсли;
	Объект.ВидНоменклатуры = Справочники.ВидыНоменклатуры.НайтиПоНаименованию("Товар", Истина);
	
	СтатусНовый = "Новый слот";                
	Если Лев(ПараметрыОбъекта["амбСтатусСлота"], СтрДлина(СтатусНовый)) = СтатусНовый Тогда
		Объект.Записать();
		
		//МассивСтруктур = Новый Массив;
		//МассивСтруктур.Добавить(Новый Структура("Свойство, Значение",ПланыВидовХарактеристик.ДополнительныеРеквизитыИСведения.НайтиПоНаименованию("СтатусСлота", Истина), СтатусНовый));
		
    	//УправлениеСвойствами.ЗаписатьСвойстваУОбъекта(Объект.Ссылка, МассивСтруктур);
		Свойство = ПланыВидовХарактеристик.ДополнительныеРеквизитыИСведения.НайтиПоНаименованию("СтатусСлота", Истина);
		СтатусСлота = Объект.ДополнительныеРеквизиты.Найти(Свойство, "Свойство");                       
		НаименованиеСлота = "Новый слот";
		Если СтатусСлота = Неопределено Тогда
			СтатусСлота = Объект.ДополнительныеРеквизиты.Добавить();
			СтатусСлота.Свойство = Свойство.Ссылка;
			СтатусСлота.Значение = "НовыйСлот";
		Иначе
			СтатусСлота.Значение = "НовыйСлот";
			//Если СокрЛП(СтатусСлота.Значение) = "НовыйСлот" и Не Лев(Наименование, СтрДлина(НаименованиеСлота)) = НаименованиеСлота Тогда
			//	 СтатусСлота.Значение = "СлотЗаполнен";
			//КонецЕсли;
		КонецЕсли;
	КонецЕсли;
		
КонецЕсли;
</ПослеЗагрузки>
				<НеЗапоминатьВыгруженные>true</НеЗапоминатьВыгруженные>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<Источник>СправочникСсылка.Номенклатура</Источник>
				<Приемник>СправочникСсылка.Номенклатура</Приемник>
				<Свойства>
					<Свойство>
						<Код>1</Код>
						<Наименование>Артикул --&gt; Артикул</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Артикул" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Артикул" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = Источник.Артикул+" ["+Источник.Производитель.Наименование+"]";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>--&gt; ВидНоменклатуры</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ВидНоменклатуры" Вид="Реквизит" Тип="СправочникСсылка.ВидыНоменклатуры"/>
						<ПередВыгрузкой>Если Источник.ЭтоГруппа Тогда
	Отказ = Истина;
Иначе
	//ИсходящиеДанные = Новый Структура;
	//ИсходящиеДанные.Вставить("ВестиУчетПоХарактеристикам", (Источник.ТипНоменклатуры.ИспользованиеХарактеристик &lt; 3));
	Значение = "Товар";
КонецЕсли;</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<ПриводитьКДлине>11</ПриводитьКДлине>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>Комментарий --&gt; Комментарий</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>НаименованиеПолное --&gt; НаименованиеПолное</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="НаименованиеПолное" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="НаименованиеПолное" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Значение = Источник.НаименованиеПолное + " " + Источник.Артикул+" ["+Источник.Производитель.Наименование+"]";</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство Отключить="true">
						<Код>8</Код>
						<Наименование>Родитель --&gt; Родитель</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.Номенклатура"/>
						<Приемник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.Номенклатура"/>
						<КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>СтавкаНДС --&gt; СтавкаНДС</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="СтавкаНДС" Вид="Реквизит" Тип="СправочникСсылка.СтавкиНДС"/>
						<Приемник Имя="СтавкаНДС" Вид="Реквизит" Тип="ПеречислениеСсылка.СтавкиНДС"/>
						<ПередВыгрузкой>Если Источник.ЭтоГруппа Тогда
	Отказ = Истина;
Иначе
	СтавкаНДС = Источник.СтавкаНДС;
	Выполнить(Алгоритмы.ЗаполнитьСтавкуНДС);
КонецЕсли;</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true" Обязательное="true">
						<Код>10</Код>
						<Наименование>ЭтоГруппа --&gt; ЭтоГруппа</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>11</Код>
						<Наименование>БазоваяЕдиницаИзмерения --&gt; ЕдиницаИзмерения</Наименование>
						<Порядок>550</Порядок>
						<Источник Имя="БазоваяЕдиницаИзмерения" Вид="Реквизит" Тип="СправочникСсылка.КлассификаторЕдиницИзмерения"/>
						<Приемник Имя="ЕдиницаИзмерения" Вид="Реквизит" Тип="СправочникСсылка.ЕдиницыИзмерения"/>
						<КодПравилаКонвертации>ЕдиницыИзмерения                                  </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>12</Код>
						<Наименование>--&gt; амбСтатусСлота</Наименование>
						<Порядок>600</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>амбСтатусСлота</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = Строка(Источник.амбСтатусСлота);
</ПередВыгрузкой>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ЕдиницыИзмерения</Код>
				<Наименование>Справочник: Классификатор единиц измерения</Наименование>
				<Порядок>150</Порядок>
				<НеЗамещать>true</НеЗамещать>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>true</ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>
				<Источник>СправочникСсылка.КлассификаторЕдиницИзмерения</Источник>
				<Приемник>СправочникСсылка.ЕдиницыИзмерения</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<ПередВыгрузкой>Значение = СокрЛП(Источник.Код);</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>НаименованиеПолное --&gt; НаименованиеПолное</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="НаименованиеПолное" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="НаименованиеПолное" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
		</Группа>
		<Группа>
			<Код>Перечисления</Код>
			<Наименование>Перечисления</Наименование>
			<Порядок>100</Порядок>
		</Группа>
	</ПравилаКонвертацииОбъектов>
	<ПравилаВыгрузкиДанных>
		<Группа Отключить="false">
			<Код>Справочники</Код>
			<Наименование>Справочники</Наименование>
			<Порядок>50</Порядок>
			<Правило Отключить="true">
				<Код>НоменклатураВНаличии</Код>
				<Наименование>НоменклатураВНаличии                             </Наименование>
				<Порядок>50</Порядок>
				<СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных>
				<ПередОбработкойПравила>Запрос = Новый Запрос;
Запрос.Текст = 
	"ВЫБРАТЬ
	|	ОстаткиТоваровКомпанииОстатки.Номенклатура 
	|ИЗ
	|	РегистрНакопления.ОстаткиТоваровКомпании.Остатки КАК ОстаткиТоваровКомпанииОстатки
	|ГДЕ
	|	ОстаткиТоваровКомпанииОстатки.КоличествоОстаток &gt; 0";


РезультатЗапроса = Запрос.Выполнить();

Выборка = РезультатЗапроса.Выбрать();

Пока Выборка.Следующий() Цикл
	ВыгрузитьПоПравилу(Выборка.Номенклатура,,,,"Номенклатура");

КонецЦикла;
</ПередОбработкойПравила>
			</Правило>
			<Правило Отключить="false">
				<Код>Номенклатура</Код>
				<Наименование>Номенклатура</Наименование>
				<Порядок>100</Порядок>
				<КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации>
				<СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных>
				<ОбъектВыборки>СправочникСсылка.Номенклатура</ОбъектВыборки>
			</Правило>
			<Правило Отключить="true">
				<Код>НоменклатураИнкремент</Код>
				<Наименование>НоменклатураИнкремент                             </Наименование>
				<Порядок>150</Порядок>
				<СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных>
				<ПередОбработкойПравила>Запрос = Новый Запрос;
Запрос.Текст = 
		"ВЫБРАТЬ
		|	амбИсторияИзменений.Объект КАК Номенклатура
		|ИЗ
		|	РегистрСведений.амбИсторияИзмененийДляКЭДО КАК амбИсторияИзменений";


РезультатЗапроса = Запрос.Выполнить();

Выборка = РезультатЗапроса.Выбрать();

Пока Выборка.Следующий() Цикл
	ВыгрузитьПоПравилу(Выборка.Номенклатура,,,,"Номенклатура");

КонецЦикла;
</ПередОбработкойПравила>
			</Правило>
		</Группа>
	</ПравилаВыгрузкиДанных>
	<ПравилаОчисткиДанных/>
	<Алгоритмы>
		<Алгоритм Имя="ЗаполнитьСтавкуНДС" ИспользуетсяПриЗагрузке="false">
			<Текст>Если СтавкаНДС = Справочники.СтавкиНДС.ОсновнаяСтавкаНДС И СтавкаНДС.Ставка = 20 Тогда
	Значение = "НДС20";
ИначеЕсли СтавкаНДС = Справочники.СтавкиНДС.ОсновнаяСтавкаНДС И СтавкаНДС.Ставка = 18 Тогда
	Значение = "НДС18";
ИначеЕсли СтрНайти(СтавкаНДС.Наименование, "120") &gt; 0 И СтавкаНДС.Ставка = 20 Тогда
	Значение = "НДС20_120";
ИначеЕсли  СтрНайти(СтавкаНДС.Наименование, "118") &gt; 0 И СтавкаНДС.Ставка = 18 Тогда
	Значение = "НДС18_118";
ИначеЕсли СтрНайти(СтавкаНДС.Наименование, "110") &gt; 0 И СтавкаНДС.Ставка = 10 Тогда
	Значение = "НДС10_110";
ИначеЕсли СтавкаНДС.Ставка = 20 Тогда
	Значение = "НДС20";
ИначеЕсли СтавкаНДС.Ставка = 18 Тогда
	Значение = "НДС18";
ИначеЕсли СтавкаНДС.Ставка = 10 Тогда
	Значение = "НДС10";
ИначеЕсли СтавкаНДС = Справочники.СтавкиНДС.БезНДС Тогда
	Значение = "БезНДС";
Иначе
	Значение = "НДС0";
КонецЕсли;</Текст>
			<Параметры>СтавкаНДС, Значение</Параметры>
		</Алгоритм>
	</Алгоритмы>
	<Запросы/>
</ПравилаОбмена>